import React from "react";
import { Button } from "../../../../components/ui/button";
import {
  FiBarChart2,
  FiBox,
  FiGift,
  FiHome,
  FiMessageCircle,
  FiPackage,
  FiPlus,
  FiSettings,
  FiShoppingCart,
  FiTag,
  FiTrash2,
  FiUsers,
} from "react-icons/fi";
import { Skeleton } from "../../../../components/ui/skeleton";
import {
  getAllPermissions,
  getPermissionById,
  updatePermission,
  createPermission,
  deletePermission,
  assignPermissionsToAdmin,
  removePermissionsFromAdmin,
} from "../../../../api/Admin/PermissionApi";
import { useState } from "react";
import { useEffect } from "react";
import { Pencil } from "lucide-react";
import { toast } from "sonner";
import { useFormik } from "formik";
import * as Yup from "yup";
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
  DialogFooter,
} from "../../../../components/ui/dialog";
import { Checkbox } from "../../../../components/ui/checkbox";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "../../../../components/ui/select";
import { fetchStaff } from "../../../../api/Admin/AuthApi";
import { SlSettings } from "react-icons/sl";
import {
  LuLayoutDashboard,
  LuPanelsRightBottom,
  LuUsersRound,
} from "react-icons/lu";
import { PiLockKeyOpen, PiShieldChevron } from "react-icons/pi";
import { HiOutlineShoppingBag, HiOutlineShoppingCart } from "react-icons/hi";
import { IoMdInformationCircleOutline } from "react-icons/io";
import { CiDiscount1 } from "react-icons/ci";
import {
  IoColorPaletteOutline,
  IoDiamondOutline,
  IoDocumentAttachOutline,
  IoFileTrayStackedOutline,
} from "react-icons/io5";
import { BsBarChartLine, BsBox } from "react-icons/bs";
import { TfiLink } from "react-icons/tfi";
import { GiBigDiamondRing } from "react-icons/gi";
import { MdCurrencyExchange } from "react-icons/md";
import { LiaBoxesSolid, LiaGiftSolid, LiaShippingFastSolid } from "react-icons/lia";

const menuItems = [
  {
    icon: <LuLayoutDashboard />,
    label: "Dashboard",
    link: "/admin/dashboard",
    permission: "dashboard",
  },
  {
    icon: <LuPanelsRightBottom />,
    label: "Master Panel",
    permission: "master-panel",
    subItems: [
      {
        icon: (
          <svg
            viewBox="0 0 64 64"
            className="size-4"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path d="M60.784 52.617c.005-.003-3.733-8.7-3.734-8.712A3.139 3.139 0 0054.162 42H46.65a3.118 3.118 0 00-.018-2.395l-4.59-10.709a3.138 3.138 0 00-2.887-1.904H24.845a3.138 3.138 0 00-2.887 1.904l-4.59 10.71A3.118 3.118 0 0017.35 42H9.837a3.137 3.137 0 00-2.888 1.905L2.36 54.613a3.162 3.162 0 002.889 4.38h23.487a3.141 3.141 0 002.888-4.38l-4.555-10.629h9.864l-4.555 10.63a3.141 3.141 0 002.887 4.378h23.488a3.162 3.162 0 002.887-4.379zM19.206 40.393l4.59-10.71a1.141 1.141 0 011.05-.69h14.308a1.141 1.141 0 011.05.69l3.132 7.31H29a1 1 0 000 2h15.193l.6 1.4a1.148 1.148 0 01-1.05 1.591H20.256a1.148 1.148 0 01-1.05-1.591zm10.482 16.085a1.124 1.124 0 01-.953.514H5.248a1.148 1.148 0 01-1.05-1.592l4.59-10.708A1.14 1.14 0 019.837 44h14.309a1.14 1.14 0 011.05.692l3.128 7.3H14a1 1 0 000 2H29.18c.224.682 1.05 1.784.507 2.486zm30.017 0a1.124 1.124 0 01-.953.514H35.264a1.148 1.148 0 01-1.05-1.592l4.59-10.708a1.14 1.14 0 011.05-.692h14.308a1.14 1.14 0 011.05.692l3.129 7.3H44a1 1 0 000 2h15.198c.223.682 1.049 1.784.507 2.486zM10 20.992a1 1 0 000 2 7.008 7.008 0 017 7 1 1 0 002 0 7.008 7.008 0 017-7 1 1 0 000-2 7.008 7.008 0 01-7-7 1 1 0 00-2 0 7.008 7.008 0 01-7 7zm8-2.879a9.06 9.06 0 003.879 3.88 9.06 9.06 0 00-3.88 3.878 9.06 9.06 0 00-3.879-3.879A9.06 9.06 0 0018 18.113zm-14-5.62a4.505 4.505 0 014.5 4.5 1 1 0 002 0 4.505 4.505 0 014.5-4.5 1 1 0 000-2 4.505 4.505 0 01-4.5-4.5 1 1 0 00-2 0 4.505 4.505 0 01-4.5 4.5 1 1 0 000 2zm5.5-3.04a6.554 6.554 0 002.039 2.04 6.555 6.555 0 00-2.04 2.038 6.555 6.555 0 00-2.038-2.039A6.555 6.555 0 009.5 9.453zM4 32.493a4.505 4.505 0 014.5 4.5 1 1 0 002 0 4.505 4.505 0 014.5-4.5 1 1 0 000-2 4.505 4.505 0 01-4.5-4.5 1 1 0 00-2 0 4.505 4.505 0 01-4.5 4.5 1 1 0 000 2zm5.5-3.04a6.554 6.554 0 002.039 2.04 6.555 6.555 0 00-2.04 2.038 6.555 6.555 0 00-2.038-2.039A6.555 6.555 0 009.5 29.453zm34.5-2.46a.997.997 0 00.707-.294l2.828-2.828a1 1 0 00-1.414-1.414l-2.828 2.828A1.007 1.007 0 0044 26.992zm-3.397-1.847a1.002 1.002 0 001.224-.707l1.036-3.864a1 1 0 10-1.932-.517l-1.035 3.864a1 1 0 00.707 1.224zm4.242 4.243a1.001 1.001 0 001.225.707l3.864-1.035a1 1 0 00-.518-1.932l-3.864 1.035a1 1 0 00-.707 1.225z" />
          </svg>
        ),
        label: "Material Type",
        link: "/admin/master-panel/material-type",
        permission: "material-type",
      },
      {
        icon: <GiBigDiamondRing />,
        label: "Jewellery Type",
        link: "/admin/master-panel/jewellery-type",
        permission: "jewellery-type",
      },
      {
        icon: <TfiLink />,
        label: "Metal Master",
        link: "/admin/master-panel/metal-master",
        permission: "metal-master",
      },
      {
        icon: <IoColorPaletteOutline />,
        label: "Material Color",
        link: "/admin/master-panel/material-color",
        permission: "material-color",
      },

      {
        icon: <IoDiamondOutline />,
        label: "Gemstone Master",
        link: "/admin/master-panel/gemstone-master",
        permission: "gemstone-master",
      },
      {
        icon: (
          <svg
            viewBox="0 0 512 512"
            className="size-4"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path d="M171.265 328H276.5a6 6 0 000-12H171.265a6 6 0 000 12zm0 55h215.21a6 6 0 000-12h-215.21a6 6 0 000 12zM228.4 185a6 6 0 006 6h57.043a31.949 31.949 0 01-31.592 26H234.4a6.215 6.215 0 00-4.121 10.654l63.612 60.16a5.982 5.982 0 008.482-.2 6.231 6.231 0 00-.24-8.672L249.484 229h10.365a43.672 43.672 0 0043.743-38h19.749a6 6 0 000-12h-19.749a45.1 45.1 0 00-13.526-26h33.275a6 6 0 000-12H234.4a6 6 0 000 12h25.451a31.949 31.949 0 0131.592 26H234.4a6 6 0 00-6 6z" />
            <path d="M81.456 358a27.5 27.5 0 000 55H100v47.077a5.736 5.736 0 005.762 5.923h346.215a5.954 5.954 0 006.023-5.923V51.923A5.954 5.954 0 00451.977 46H105.762A5.736 5.736 0 00100 51.923V88H81.456a27 27 0 100 54H100v36H81.456a27.5 27.5 0 000 55H100v35H81.456a27.5 27.5 0 000 55H100v35zm0 43a15.5 15.5 0 010-31H100v31zm0-271a15.006 15.006 0 110-30H100v30zm0 91a15.5 15.5 0 010-31H100v31zm0 90a15.5 15.5 0 010-31H100v31zM135 334.2a6 6 0 006-6v-22.564a6 6 0 00-12 0V311h-17v-78h17v4.951a6 6 0 1012 0v-22.562a6 6 0 00-12 0V221h-17v-79h17v5.7a6 6 0 0012 0v-22.557a6 6 0 00-12 0V130h-17V58h334v396H112v-41h17v5.443a6 6 0 0012 0v-22.561a6 6 0 00-12 0V401h-17v-78h17v5.2a6 6 0 006 6z" />
          </svg>
        ),
        label: "Making Charge Master",
        link: "/admin/master-panel/making-charge-master",
        permission: "making-charge-master",
      },
      {
        icon: (
          <svg
            viewBox="0 0 32 32"
            className="size-4"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M12 3v4.277a1.99 1.99 0 01-1.648 1.968C7.754 9.696 3 10.82 3 13c0 5 6 12 13 12s13-7 13-12c0-2.18-4.754-3.304-7.352-3.756A1.99 1.99 0 0120 7.277V3h-8z"
              fill="none"
              stroke="#000"
              strokeLinecap="round"
              strokeWidth="2"
            />
            <path
              d="M9.333 23c0 2-.444 4-1.333 6h16c-.889-2-1.333-4-1.333-6M12 13.1V16m8-2.9V16m-4 0l-2 3 2 2 2-2zm0-2v2m6.995-6.431C22.285 12.104 19.423 14 16 14c-3.426 0-6.29-1.899-6.997-4.438"
              fill="none"
              stroke="#000"
              strokeLinecap="round"
              strokeWidth="2"
            />
          </svg>
        ),
        label: "Product Style",
        link: "/admin/master-panel/product-style",
        permission: "product-style",
      },
      {
        icon: <BsBox className="size-4" />,
        label: "Collections",
        link: "/admin/master-panel/collections",
        permission: "collections",
      },
      {
        icon: <IoFileTrayStackedOutline />,
        label: "Size Management",
        link: "/admin/master-panel/size-management",
        permission: "size-management",
      },
      {
        icon: (
          <svg
            viewBox="0 0 1024 1024"
            className="size-4"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path d="M482.082 178.06c2.248-9.97 5.082-28.041 17.264-29.902 13.552.596 15.458 19.516 18.478 29.903 49.054-.272 42.398 11.21 10.446 34.151 3.262 9.006 7.732 18.984 7.17 28.658-9.946 16.156-26.076-4.118-36.094-9.346-6.984 5.286-28.832 26.51-35.604 10.1-2.906-7.04 4.646-22.422 7.3-29.412-6.644-5.744-33.23-19.399-20.808-30.961 5.38-5.007 24.258-3.232 31.848-3.19zm17.264 9.326c-1.336 3.1-2.324 6.474-3.836 9.468-3.048-.064-6.334-.356-9.348 0 2.322 2.542 4.752 5.016 6.636 7.912-.408 2.528-.85 4.976-1.552 7.446 2.7-.778 7.214-2.718 9.954-2.118 2.446 1.244 4.566 2.694 6.78 4.302-.128-3.212.17-6.436 0-9.63 1.73-2.984 4.092-5.382 6.406-7.912-3.224.019-6.494.136-9.714 0-1.652-3.176-3.196-6.59-5.326-9.468zm178.046 10.88c6.828-10.642 19.148-35.772 30.302-40.696 14.962-.875 14.02 13.476 15.246 24.13l3.232 28.394c9.762 2.148 46.428 8.248 51.156 17.024 8.112 15.066-32.26 27.742-44.278 33.86l.11 36.306c.038 5.666.616 11.438-.11 17.072-8.708 16.53-21.96-1.728-29.138-9.58-6.558-7.174-13.272-14.266-19.488-21.742-1.262-.152-2.764-.004-4.048 0-6.228 3.18-57.738 32.418-53.65 6.404 1.482-9.432 17.666-33.91 22.466-45.69-9.81-17.902-62.99-65.802-2.276-52.474l30.476 6.991zm25.846 0c-21.274 27.994-13.61 24.66-49.136 16.13 4.672 6.99 14.58 16.798 17.326 23.924 3.924 10.182-8.22 22.896-12.376 31.404 8.504-2.498 16.608-7.558 25.372-8.746 12.156-.116 20.578 13.338 27.17 22.056 1.452-36.984-10.006-30.162 26.302-48.36-9.25-2.134-24.446-3.494-29.784-12.038-3.966-6.348-3.71-22.791-4.874-24.37zm-235.51 269.556c-7.698 1.678-16.618-4.68-13.192-13.194 2.092-5.204 11.622-15.112 15.508-20.462 28.172-38.794 47.594-83.42 54.244-131.142 2.19-15.718-2.872-37.828 11.152-43.952 15.082-2 13.532 14.422 12.866 24.74-4.002 61.934-27.346 120.386-65.578 169.006-4.222 5.37-8.598 12.144-15 15.004zm-46.888-61.048c-18.526-2.11-8.88-16.956-3.79-24.988 21.528-33.976-3.942-78.804-41.452-86.088-5.776-1.122-15.19.042-19.852-3.544-8.584-6.602-2.332-18.006 7.094-18.638 64.166-.88 102.744 66.216 71.614 120.9-3.372 5.922-6.748 10.488-13.614 12.358zm352.732-33.026c.584-13.84-2.948-43.98 12.318-47.142 11.172.564 25.154 23.164 33.394 30.99 7.79-1.704 58.802-22.11 49.112 4.104-3.524 9.538-14.834 23.012-19.852 33.316l-.322.67c9.338 11.708 34.47 36.776 14.13 46.85-13.468-1.66-27.208-5.21-40.534-7.88l-6.3 8.124c-5.002 6.438-16.43 23.996-24.738 24.768-15.882 1.472-15.24-35.814-15.736-45.654-10.428-2.756-39.984-10.832-44.624-20.352-5.086-10.434 11.328-15.2 18.07-17.902l25.082-9.892zm20.922-9.634c1.976 29.958-3.98 22.53-24.102 35.128 23.714 2.34 23.87 12.124 26.314 32.778 4.738-6.33 9.396-14.686 16.61-18.318 7.566-1.776 16.792 1.158 24.25 2.722-15.754-18.074-14.742-22.958 0-40.882-43.014 11.56-22.538-2.198-43.072-11.428zM596.978 383.44c-2.778-11.682-14.508-34.874 3.814-38.322 10.274 1.102 17.812 13.152 25.82 18.996 7.648-6.656 26.338-27.86 35.514-13.994 4.514 6.818-4.068 24.756-5.81 32.542l-.17.778c8.034 6.85 28.914 17.894 22.372 29.79-6.972 12.68-32.896 1.88-36.514 9.872-2.002 8.554-4.58 38.466-20.628 29.778-6.614-3.58-10.208-24.704-12.942-32.85-8.504-.904-26.802.604-32.92-5.14-12.942-12.152 14.86-25.5 21.464-31.45zm21.062 0c.854 3.15 2.836 5.838 4.558 8.58-3.078 2.242-6.134 4.356-8.672 7.222l8.672 1.38c1.332 2.94 2.624 5.908 4.014 8.82 1.538-2.99 3.056-5.966 4.842-8.82 3.524-.122 7.026-.078 10.55 0-3.094-2.656-5.544-4.944-7.496-8.602-.252-2.91-.64-5.696 0-8.58-2.608 1.504-5.212 2.978-7.896 4.346-2.782-1.588-5.524-3.316-8.572-4.346zM322.624 808.788c-18.888 8.632-128.742 64.22-143.198 64.3-16.78.092-29.51-13.024-28.791-29.844.638-14.956 30.378-71.382 38.022-87.678L318.472 476.29c7.708-16.522 14.654-45.172 35.616-44.27 15.862-5.2 46.57 32.938 57.256 43.65l137.924 138.874c14.916 14.76 62.136 48.818 30.898 69.668-8.674 5.792-20.08 10.09-29.578 14.686l-227.964 109.89zm31.464-357.022c-8.846 12.25-26.878 56.248-33.502 71.448 14.92 16.018 30.916 31.098 46.372 46.604l114.96 115.302c5.124 5.09 10.532 10.058 15.38 15.412 8.496-4.004 16.92-8.154 25.35-12.294l46.336-22.508c-17.312-19.146-38.086-38.49-56.618-57.108l-120.48-121.1c-6.22-6.156-31.268-34.614-37.798-35.756zm-43.666 92.144c-10.594 23.312-25.122 51.952-34.076 75.366 6.91 7.972 15.164 15.036 22.652 22.478l75.568 76.156c9.116 9.29 18.034 19.012 27.698 27.74 9.52-3.996 18.77-8.804 28.062-13.308l46.416-21.8c-8.47-8.894-17.452-17.32-26.124-26.02L335.196 567.906c-8.12-8.15-15.814-16.74-24.774-23.996zm-43.608 95.89c-9.868 20.154-19.046 40.578-28.518 60.912l-34.134 72.29c-8.564 18.152-27.866 53.98-32.778 72.524 1.839 2.542 3.952 5.542 7.347 5.892 4.353.448 64.315-29.294 73.393-33.658l111.936-53.05c6.04-2.91 12.26-5.464 17.962-9.018l-103.76-104.686c-3.634-3.628-7.39-8.104-11.448-11.206zM507.98 518.468c-8.6.736-15.834-7.286-11.736-15.808 1.504-3.126 43.042-44.096 49.756-46.546 8.426-.62 16.144 5.85 12.166 14.856-2.732 6.182-40.772 43.928-50.186 47.498zm78.462 25.442c-11.044 3.39-21.496 16.774-31.922 18.638-9.09 1.626-15.436-10.622-9.438-17.448 4.446-5.06 12.03-9.062 17.62-12.888 41.266-28.244 90.778-44.656 140.536-48.13 11.968-.298 49.608-1.86 57.23 7.22 3.71 4.42 3.952 10.904-.928 14.524-6.63 4.916-16.468 1.786-23.982.774-42.912-5.782-113.316 10.008-149.116 37.31zm38.686 65.872c-8.14-2.296-15.064-10.344-7.486-18.212 7.72-8.012 25.848-10.882 36.46-11.128 34.564-2.84 67.118 18.922 80.084 50.79 2.826 6.944 7.286 19.264 3.96 26.554-2.398 5.258-9.576 7.304-14.626 4.694-6.78-3.5-6.582-14.25-8.52-20.706-9.832-29.212-43.62-47.034-73.206-38.048-5.666 1.722-10.912 4.584-16.666 6.056z" />
          </svg>
        ),
        label: "Occasion",
        link: "/admin/master-panel/occasion",
        permission: "occasion",
      },
      {
        icon: <CiDiscount1 />,
        label: "Global Discount",
        link: "/admin/master-panel/global-discount",
        permission: "global-discount",
      },
    ],
  },
  {
    icon: (
      <svg
        viewBox="0 0 6.35 6.35"
        fill="currentColor"
        className="size-3"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          style={{ InkscapeStroke: "none" }}
          d="M.793 0A.797.797 0 000 .793v4.764c0 .435.358.793.793.793h4.764a.797.797 0 00.793-.793V.793A.797.797 0 005.557 0zm0 .53h4.764c.15 0 .263.112.263.263v4.764a.257.257 0 01-.263.263H.793a.257.257 0 01-.264-.263V.793A.258.258 0 01.793.529z"
        />
        <path
          style={{ InkscapeStroke: "none" }}
          d="M2.38 0a.265.265 0 00-.263.264V2.38a.265.265 0 00.264.265h1.588a.265.265 0 00.263-.265V.264A.265.265 0 003.97 0a.265.265 0 00-.264.264v1.853h-1.06V.264A.265.265 0 002.381 0z"
        />
      </svg>
    ),
    label: "Products",
    permission: "products",
    subItems: [
      {
        icon: <HiOutlineShoppingBag />,
        label: "All Products",
        link: "/admin/product/all-products",
        permission: "all-products",
      },
      {
        icon: (
          <svg
            viewBox="0 0 24 24"
            stroke="2"
            className="size-3"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path d="M7 6h5a1 1 0 000-2H7a1 1 0 000 2z" />
            <path d="M23.044.956a3.215 3.215 0 00-4.438-.138 4.752 4.752 0 00-1.254-.385A33.415 33.415 0 006.654.432C4.538.766 2.842 2.499 2.531 4.645A50.983 50.983 0 002 12c0 2.414.175 4.88.52 7.333.315 2.182 1.975 3.883 4.128 4.234C8.396 23.854 10.196 24 12 24c.746 0 1.507-.024 2.272-.072a5.013 5.013 0 003.209-1.474l2.88-2.912a4.944 4.944 0 001.445-3.104c.129-1.456.194-2.95.194-4.438 0-1.687-.097-3.412-.267-5.134.477-.465.952-.932 1.405-1.415 1.194-1.274 1.153-3.249-.094-4.495zM18.191 7.4c-.72.609-1.47 1.2-2.228 1.758-.599.44-1.282.742-2.014.893.151-.732.452-1.415.893-2.014A41.26 41.26 0 0116.6 5.809a41.526 41.526 0 012.145-2.324l1.77 1.77A41.6 41.6 0 0118.191 7.4zM6.971 21.593A2.988 2.988 0 014.5 19.051C4.169 16.693 4 14.32 4 12c0-2.377.171-4.753.51-7.066.187-1.289 1.197-2.328 2.459-2.527a31.402 31.402 0 0110.028-.004c-.664.688-1.31 1.39-1.923 2.114a43.634 43.634 0 00-1.843 2.335c-.035.047-.059.1-.092.148H7a1 1 0 000 2h5.163c-.099.327-.184.659-.237 1H7a1 1 0 000 2h5.323a.972.972 0 00.514.163 7.22 7.22 0 004.311-1.394 44.216 44.216 0 002.335-1.842c.13-.111.254-.232.384-.345C19.946 9.73 20 10.874 20 12a48.87 48.87 0 01-.103 3H17c-1.654 0-3 1.346-3 3v3.937a31.776 31.776 0 01-7.03-.344zm9.087-.545c-.018.018-.04.031-.058.049V18c0-.551.449-1 1-1h2.646a2.91 2.91 0 01-.697 1.127l-2.89 2.921zm5.808-17.27l-1.643-1.644a1.24 1.24 0 011.407.236c.381.381.452.95.236 1.408z" />
          </svg>
        ),
        label: "Draft Products",
        link: "/admin/product/draft-products",
        permission: "draft-products",
      },
      {
        icon: <IoMdInformationCircleOutline />,
        label: "Low & Out of Stock",
        link: "/admin/product/low-and-out-of-stock-products",
        permission: "low-stock-products",
      },
    ],
  },
  {
    icon: <HiOutlineShoppingCart />,
    label: "Orders",
    link: "/admin/orders",
    permission: "orders",
  },
  // {
  //   icon: <FiGift />,
  //   label: "Custom",
  //   link: "/admin/custom-orders",
  //   permission: "custom-orders",
  // },
  {
    icon: <FiUsers />,
    label: "Manage Customer",
    link: "/admin/manage-customer",
    permission: "manage-customer",
  },
  {
    icon: <FiTag />,
    label: "Coupons",
    link: "/admin/coupon",
    permission: "coupon",
  },
  // {
  //   icon: <FiGift />,
  //   label: "Promotions",
  //   link: "/admin/promotions",
  //   permission: "promotions",
  // },
  {
    icon: <FiMessageCircle />,
    label: "Reviews & Ratings",
    link: "/admin/reviews-and-ratings",
    permission: "reviews-and-ratings",
  },
  {
    icon: (
      <svg
        viewBox="0 0 48 48"
        className="size-4"
        xmlns="http://www.w3.org/2000/svg"
        fill="currentColor"
      >
        <path d="M44 26a3 3 0 00-3-3v-6a17 17 0 00-34 0v6a3 3 0 00-3 3 4 4 0 000 8 3 3 0 003 3h4a1 1 0 001-1V24a1 1 0 00-1-1H9v-6a15 15 0 0130 0v6h-2a1 1 0 00-1 1v12a1 1 0 001 1h2v2a5 5 0 01-5 5h-5.18A3 3 0 0026 42h-4a3 3 0 000 6h4a3 3 0 002.82-2H34a7 7 0 007-7v-2a3 3 0 003-3 4 4 0 000-8zM2 30a2 2 0 012-2v4a2 2 0 01-2-2zm8 5H7a1 1 0 01-1-1v-8a1 1 0 011-1h3zm16 11h-4a1 1 0 010-2h4a1 1 0 010 2zm16-12a1 1 0 01-1 1h-3V25h3a1 1 0 011 1zm2-2v-4a2 2 0 010 4z" />
      </svg>
    ),
    label: "Support",
    link: "/admin/support",
    permission: "support",
  },
  {
    icon: (
      <svg
        viewBox="0 0 16 16"
        className="size-4"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M11 6.77c.226 0 .447.018.663.054l.019.08a2 2 0 002.508 1.45c.279.358.502.765.656 1.206a2 2 0 000 2.88 4.265 4.265 0 01-.656 1.207 2 2 0 00-2.508 1.45l-.02.079a3.98 3.98 0 01-1.325 0l-.019-.08a2 2 0 00-2.508-1.45 4.267 4.267 0 01-.656-1.206 2 2 0 000-2.88c.154-.44.377-.848.656-1.207a2 2 0 002.508-1.45l.02-.079c.215-.036.436-.055.662-.055zM11.502 2a2.5 2.5 0 012.5 2.5v2.501a4.996 4.996 0 00-1-.584V5H3v6.502a1.5 1.5 0 001.5 1.5h1.917c.156.357.353.692.584 1H4.5a2.5 2.5 0 01-2.5-2.5V4.5A2.5 2.5 0 014.5 2h7.002zM11 9.846c-.616 0-1.115.517-1.115 1.154 0 .637.5 1.154 1.115 1.154.616 0 1.115-.517 1.115-1.154 0-.637-.5-1.154-1.115-1.154zM7.502 6a.5.5 0 01.5.5v.5a5.03 5.03 0 00-1 .998V7H5.004v4H6c0 .343.034.678.1 1H4.504a.5.5 0 01-.5-.5v-5a.5.5 0 01.5-.5h2.998z"
          fill="currentColor"
        />
      </svg>
    ),
    label: "CMS",
    permission: "cms",
    subItems: [
      {
        icon: (
          <svg
            viewBox="0 0 128 128"
            className="size-4"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path d="M112 36.875a1 1 0 001-1v-2.437a3.426 3.426 0 00-1.8-3 5.188 5.188 0 10-7.4 0 3.426 3.426 0 00-1.8 3v1.438H31a1 1 0 000 2h71v57.687a3.426 3.426 0 001.8 3 5.188 5.188 0 107.4 0 3.426 3.426 0 001.8-3V41.625a1 1 0 00-2 0v52.938A1.439 1.439 0 01109.562 96h-4.125A1.439 1.439 0 01104 94.563V33.438A1.439 1.439 0 01105.437 32h4.125A1.439 1.439 0 01111 33.438v2.438a1 1 0 001 .999zm-4.5-13.25a3.188 3.188 0 11-3.188 3.188 3.191 3.191 0 013.188-3.188zm0 80.75a3.188 3.188 0 113.187-3.187 3.191 3.191 0 01-3.187 3.187z" />
            <path d="M97 91.125H26V33.438a3.426 3.426 0 00-1.8-3 5.188 5.188 0 10-7.4 0 3.426 3.426 0 00-1.8 3v61.125a3.426 3.426 0 001.8 3 5.188 5.188 0 107.4 0 3.426 3.426 0 001.8-3v-1.438h71a1 1 0 000-2zm-73 3.438A1.439 1.439 0 0122.563 96h-4.125A1.439 1.439 0 0117 94.563V33.438A1.439 1.439 0 0118.438 32h4.125A1.439 1.439 0 0124 33.438zm-3.5-70.938a3.188 3.188 0 11-3.187 3.188 3.191 3.191 0 013.187-3.188zm0 80.75a3.188 3.188 0 113.188-3.187 3.191 3.191 0 01-3.188 3.187z" />
            <path d="M64.177 56.045L46.322 73.9a1 1 0 101.414 1.414l17.855-17.855a1 1 0 10-1.414-1.414zm5.833-3.005l5.3-5.3a1 1 0 00-1.41-1.418l-5.3 5.3a1 1 0 101.41 1.418zM56.929 77.435a1 1 0 001.414 0L76.2 59.581a1 1 0 00-1.414-1.414L56.929 76.021a1 1 0 000 1.414z" />
          </svg>
        ),
        label: "Banners",
        link: "/admin/cms/banners",
        permission: "banners",
      },
      {
        icon: (
          <svg
            className="nav-icon size-4"
            viewBox="0 0 25 25"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              style={{
                textIndent: "0",
                textAlign: "start",
                lineHeight: "normal",
                textTransform: "none",
                blockProgression: "tb",
                marker: "none",
                InkscapeFontSpecification: "Sans",
              }}
              d="M12.5 0C5.602 0 0 5.602 0 12.5S5.602 25 12.5 25 25 19.398 25 12.5 19.398 0 12.5 0zm0 .969A11.519 11.519 0 0124.031 12.5c0 6.378-5.153 11.563-11.531 11.563C6.122 24.063.969 18.878.969 12.5A11.519 11.519 0 0112.5.969zm3.688 4.656a.5.5 0 00-.282.281L14.97 7.75 7 12.063V19h.5l6.469.031 4.219-7.843a.5.5 0 00.156-.063l1.812-1a.5.5 0 00.094-.813l-3.531-3.53a.5.5 0 00-.375-.157.5.5 0 00-.094 0 .5.5 0 00-.063 0zm.312 1.344l2.594 2.593-.907.5L16 7.906l.5-.937zM6 7v1h5.031V7H6zm9.344 1.656l2 2L13.375 18H8.719l2.375-2.344a1.48 1.48 0 001.687-.281 1.512 1.512 0 000-2.125 1.512 1.512 0 00-2.125 0 1.482 1.482 0 00-.281 1.688L8 17.343v-4.688l7.344-4zm-3.625 5.156c.127 0 .275.026.375.126.2.199.2.519 0 .718-.2.2-.52.2-.719 0-.2-.2-.2-.519 0-.719.1-.1.217-.124.344-.124z"
            />
          </svg>
        ),
        label: "Blogs",
        link: "/admin/cms/blog-page",
        permission: "blog-page",
      },
      {
        icon: (
          <svg
            viewBox="0 0 24 24"
            className="size-4"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path d="M0 0h24v24H0z" fill="none" />
            <path
              d="M15.278 20.72a3.086 3.086 0 01-.621-.9H8.409a2.706 2.706 0 01-2.7-2.7V8.267a3 3 0 01.895-5.865 3 3 0 01.908 5.859v1.951h7.025a2.99 2.99 0 11.006 1.8H7.512v5.106a.9.9 0 00.9.9h6.047a3 3 0 11.822 2.7zm.922-2.121a1.2 1.2 0 101.2-1.2 1.2 1.2 0 00-1.2 1.197zm0-7.5a1.2 1.2 0 101.2-1.2 1.2 1.2 0 00-1.2 1.197zm-10.8-5.7a1.2 1.2 0 101.2-1.2 1.2 1.2 0 00-1.2 1.197z"
              fill="#525863"
            />
          </svg>
        ),
        label: "Blog Categories",
        link: "/admin/cms/blog-category",
        permission: "blog-category",
      },
      {
        icon: <IoDocumentAttachOutline className="size-4" />,
        label: "Important Links",
        link: "/admin/cms/important-links",
        permission: "important-links",
      },
      {
        icon: <MdCurrencyExchange className="size-4" />,
        label: "Currency",
        link: "/admin/cms/currency",
        permission: "currency",
      },
      {
        icon: <LiaShippingFastSolid className="size-4" />,
        label: "Promotional Script",
        link: "/admin/cms/promotional-script",
        permission: "promotional-script",
      },
    ],
  },
  {
    icon: (
      <svg
        viewBox="0 0 79 79"
        className="size-4"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M35.295 70.324c0 .325.213.65.639.897.431.246.986.37 1.54.364.56 0 1.11-.118 1.536-.37l9.732-5.57.006-1.75 1.193-.706v.585c4.897 2.695 12.668 2.656 17.498-.145 2.482-1.43 3.715-3.306 3.715-5.178l-.011-2.496c0-1.855-1.222-3.71-3.654-5.121-4.88-2.835-12.808-2.852-17.722-.017-2.504 1.446-3.748 3.328-3.742 5.205l.01 1.877c.006 1.233.544 2.454 1.62 3.552l-1.098.634-.885-.51-9.744 5.569c-.438.257-.642.59-.625.924l-.002-.022v.045l-.006 2.233z"
          fill="#FFF"
        />
        <path
          d="M68.737 55.979a3.83 3.83 0 01-.49 1.782c-.48.88-1.338 1.694-2.519 2.374-1.927 1.114-4.468 1.727-7.175 1.727-2.708 0-5.26-.613-7.176-1.727-1.137-.658-1.961-1.449-2.451-2.307a3.724 3.724 0 01-.502-1.85c.011-1.57 1.081-3.041 3.02-4.167 1.939-1.114 4.468-1.716 7.164-1.716 2.719 0 5.27.613 7.187 1.728 1.906 1.103 2.953 2.585 2.942 4.156"
          fill="#D9DADF"
        />
        <path
          d="M65.728 60.135c-1.927 1.114-4.468 1.727-7.175 1.727-2.708 0-5.26-.613-7.176-1.727-1.137-.658-1.961-1.449-2.451-2.307a3.839 3.839 0 01-.422-1.135c.27-1.311 1.285-2.524 2.94-3.484 1.939-1.115 4.468-1.716 7.164-1.716 2.72 0 5.27.612 7.187 1.727 1.606.93 2.594 2.13 2.86 3.425a3.971 3.971 0 01-.409 1.116c-.479.88-1.337 1.694-2.518 2.374z"
          fill="#D9DADF"
        />
        <path
          d="M46.442 62.151l1.897-1.095 1.601.93-1.893 1.093z"
          fill="#FFF"
        />
        <path
          d="M48.047 63.079l1.893-1.093.003 1.202-1.195.706.005-.409z"
          fill="#FFF"
        />
        <path
          d="M71.415 55.956c-.036-.104.284-2.973-3.79-5.36-2.41-1.39-5.61-2.16-9.01-2.16-3.38 0-6.57.76-8.98 2.15-2.49 1.44-3.87 3.37-3.88 5.42v.03l.01 1.87c.03.84.63 2.23 1.46 3.48l-.68.39-.74-.43a.244.244 0 00-.26 0l-9.75 5.57c-.48.28-.76.67-.76 1.1v.03l-.01 2.28c0 1.02 1.36 1.53 2.42 1.53v-.54c-.69 0-1.88-.307-1.88-.99v-1.33c1.153.77 2.624.682 3.58.16l9.34-5.34V65.486l-9.61 5.5c-.37.21-.86.33-1.4.33l-.03.27.03.27c.63 0 1.22-.15 1.67-.41l9.74-5.57c.08-.05.13-.14.13-.23v-1.6l.43-.25c.03.02.07.04.1.06 2.41 1.4 5.61 2.17 9.01 2.17 3.4 0 6.6-.77 9.02-2.16 5.166-2.988 3.552-6.53 3.84-7.91zm-21.51-4.91c4.878-2.806 12.697-2.754 17.45.02 4.59 2.668 4.822 6.969-.06 9.83-4.77 2.763-12.645 2.818-17.49-.01-1.862-1.085-3.51-2.754-3.51-4.88 0-1.85 1.28-3.61 3.61-4.96zm-1.57 10.32l1.07.62-1.21.7h-.01l-.03.02-1.06-.62 1.24-.72zm-9.45 7.33c-1.168.675-3.32.207-3.32-.66 0-.24.18-.47.5-.66l9.61-5.49.51.29c0 .08.05.16.12.21l1.79 1.03-9.21 5.28zm10.13-5.27c.01-.019.018-.072 0-.09.026-.053-.077-.184-.13-.21l-.19-.11.98-.57v.59l-.66.39zm18.29-.03c-2.33 1.35-5.44 2.1-8.75 2.1-3.23 0-6.27-.72-8.58-2.02l.1-.06c.09-.05.14-.13.14-.23l-.01-1.2c0-.1-.05-.18-.13-.23-1.56-.854-1.64-1.073-1.87-.93l-.51.29c-.66-1-1.16-2.07-1.33-2.8.292.874 1.927 2.324 3.17 3.03 5.045 2.93 13.086 2.882 18.03.01 1.315-.756 2.64-1.879 3.32-3.24-.042.13.455 2.966-3.58 5.28z"
          fill="#979AAB"
        />
        <path
          d="M51.245 60.366c3.97 2.32 10.515 2.375 14.62 0 4.207-2.434 4.158-6.414.06-8.77-4.008-2.343-10.528-2.378-14.62-.01-4.317 2.5-4.062 6.488-.06 8.78zm14.35-.46c-3.95 2.277-10.25 2.232-14.08 0-3.118-1.807-3.877-4.174.06-6.47 3.96-2.263 10.25-2.228 14.09.02 3.69 2.125 3.23 4.551-.07 6.45zm-14.02-7.86c3.907-2.254 10.218-2.235 14.09.01 1.53.88 2.48 2.01 2.73 3.23-.5-.87-1.34-1.65-2.47-2.3-4.013-2.326-10.511-2.368-14.62-.01-1.16.68-2.01 1.48-2.54 2.35.27-1.22 1.24-2.37 2.81-3.28z"
          fill="#979AAB"
        />
        <path
          d="M68.665 32.716l-.08 4.99c0 .322-.22.644-.633.885l-11.048 6.415c-.863.518-2.242.518-3.104.023l-11.13-6.438c-.436-.253-.643-.575-.643-.897l.08-4.99c0-.321.219-.643.644-.896L53.8 25.393c.85-.494 2.241-.494 3.092 0l11.129 6.427c.437.252.644.574.644.896z"
          fill="#FFF"
        />
        <path
          d="M45.44 36.913c.377.218.668.741.666 1.155 0 .434-.293.62-.67.402-.378-.218-.686-.75-.685-1.184.002-.414.311-.59.689-.373zm2.487 1.436c.36.208.668.741.667 1.155-.002.434-.311.61-.672.402-.377-.218-.685-.75-.683-1.184 0-.414.31-.59.688-.373zm2.47 1.426c.377.218.685.751.684 1.165-.001.434-.311.61-.689.392-.377-.218-.667-.74-.666-1.174 0-.414.294-.6.67-.383z"
          fill="#662DDC"
        />
        <path
          d="M64.875 37.131c-.377.218-.668.741-.667 1.155.001.433.294.62.671.402.378-.218.685-.75.684-1.184-.001-.414-.31-.59-.688-.373zm-2.487 1.436c-.36.208-.668.741-.667 1.155.001.433.31.61.671.402.378-.218.685-.75.684-1.185-.001-.413-.31-.59-.688-.372zm-2.47 1.426c-.378.218-.685.751-.684 1.165.001.433.31.61.688.392s.668-.74.667-1.175c-.001-.413-.294-.6-.671-.382z"
          fill="#F9D893"
        />
        <path
          d="M68.665 24.285l-.08 4.99c0 .321-.22.643-.633.885l-11.048 6.415c-.863.517-2.242.517-3.104.023L42.67 30.16c-.436-.253-.643-.575-.643-.897l.08-4.99c0-.322.219-.644.644-.896L53.8 16.962c.85-.495 2.241-.495 3.092 0l11.129 6.426c.437.253.644.575.644.897z"
          fill="#FFF"
        />
        <path
          d="M45.44 28.482c.377.218.668.74.666 1.154 0 .434-.293.62-.67.403-.378-.218-.686-.751-.685-1.185.002-.414.311-.59.689-.372zm2.487 1.436c.36.208.668.74.667 1.154-.002.434-.311.61-.672.403-.377-.218-.685-.751-.683-1.185 0-.414.31-.59.688-.372zm2.47 1.426c.377.218.685.75.684 1.164-.001.434-.311.61-.689.393-.377-.218-.667-.741-.666-1.175 0-.414.294-.6.67-.382z"
          fill="#662DDC"
        />
        <path
          d="M64.875 28.7c-.377.217-.668.74-.667 1.154.001.434.294.62.671.402.378-.217.685-.75.684-1.184-.001-.414-.31-.59-.688-.372zm-2.487 1.435c-.36.208-.668.741-.667 1.155.001.434.31.61.671.402.378-.217.685-.75.684-1.184-.001-.414-.31-.59-.688-.373zm-2.47 1.427c-.378.217-.685.75-.684 1.164.001.434.31.61.688.393s.668-.741.667-1.175c-.001-.414-.294-.6-.671-.382z"
          fill="#F9D893"
        />
        <path
          d="M68.665 15.853l-.08 4.99c0 .322-.22.643-.633.885l-11.048 6.415c-.863.517-2.242.517-3.104.023l-11.13-6.438c-.436-.253-.643-.575-.643-.897l.08-4.99c0-.321.219-.643.644-.896L53.8 8.53c.85-.494 2.241-.494 3.092 0l11.129 6.427c.437.252.644.574.644.896z"
          fill="#FFF"
        />
        <path
          d="M45.44 20.05c.377.218.668.741.666 1.155 0 .434-.293.62-.67.402-.378-.218-.686-.75-.685-1.184.002-.414.311-.59.689-.373zm2.487 1.436c.36.208.668.741.667 1.155-.002.434-.311.61-.672.402-.377-.218-.685-.75-.683-1.184 0-.414.31-.59.688-.373zm2.47 1.426c.377.218.685.751.684 1.165-.001.433-.311.61-.689.392-.377-.218-.667-.74-.666-1.174 0-.414.294-.6.67-.383z"
          fill="#662DDC"
        />
        <path
          d="M64.875 20.268c-.377.218-.668.741-.667 1.155.001.433.294.62.671.402.378-.218.685-.75.684-1.185-.001-.413-.31-.59-.688-.372zm-2.487 1.436c-.36.208-.668.74-.667 1.155.001.433.31.61.671.402.378-.218.685-.751.684-1.185-.001-.413-.31-.59-.688-.372zm-2.47 1.426c-.378.218-.685.75-.684 1.165.001.433.31.61.688.392.377-.218.668-.741.667-1.175-.001-.413-.294-.6-.671-.382z"
          fill="#F9D893"
        />
        <path
          d="M13.14 62.872c-.175 0-.308-.143-.308-.333l-.104-36.707a.516.516 0 01.246-.426l19.677-11.36c.232-.132.489.023.489.273l.104 36.707c0 .175-.101.35-.252.436L13.26 62.855l-.12.017zm19.528-48.31L13.21 25.817l.094 36.467 19.452-11.23-.088-36.49z"
          fill="#D9DADF"
        />
        <path
          d="M9.45 27.37c.145.083.27.3.27.467l-.007 2.456c0 .166-.126.227-.271.143a.591.591 0 01-.27-.456l.007-2.456c0-.166.126-.238.271-.155zm-.013 4.567c.145.083.27.29.27.456L9.7 34.849c0 .177-.126.238-.271.155a.594.594 0 01-.27-.468l.007-2.456c0-.166.126-.227.271-.143z"
          fill="#4D4D56"
        />
        <path
          d="M14.663 38.613l.034 12.385c0 .549.194.93.498 1.107l2.197 1.275a.375.375 0 01-.093-.067c.313.253.786.253 1.318-.051l11.1-6.412c.947-.55 1.724-1.884 1.716-2.974l-.034-12.385c0-.557-.211-.954-.54-1.115.016 0 .033.009.041.017l-.067-.034-1.884-1.098v-.355c-.009-1.487-.532-2.534-1.377-3.016l-.178-.101-2.01-1.174c-.854-.499-2.036-.431-3.354.32l-.127.077-.127.076c-2.703 1.583-4.688 5.258-4.688 8.093v.025l.008 2.028-.726.414c-.947.549-1.715 1.875-1.707 2.965z"
          fill="#FFF"
        />
        <path
          d="M17.088 33.18v.026l.008 2.028 2.197 1.276v-2.028h-.009v-.009h.009c-.029-2.919 1.993-6.547 4.68-8.11l.253-.152c1.31-.752 2.493-.82 3.346-.32l-2.188-1.276c-.854-.499-2.036-.431-3.354.32l-.127.077-.127.076c-2.703 1.583-4.688 5.258-4.688 8.093z"
          fill="#FFF"
        />
        <path
          d="M19.289 34.479l.006 2.02 9.656-5.574-.006-2.021c-.02-7.066-9.677-1.772-9.656 5.575z"
          fill="#FFF"
        />
        <path
          d="M21.202 33.384l4.596-2.645.295-.168 1.023-.6v-.997c-.009-.583-.119-1.572-.879-1.572-1.263 0-2.857 1.533-3.675 2.73-.701 1.03-1.174 2.196-1.36 3.252z"
          fill="#D9DADF"
        />
        <path
          d="M21.202 33.384l4.596-2.645.295-.168v-.989c-.037-2.622-1.992-1.702-3.53.55-.702 1.03-1.175 2.196-1.361 3.252z"
          fill="#FFF"
        />
        <path
          d="M25.436 41.067l.851 4-1.012.587-3.243 1.872.822-4.964c-.7-.095-1.172-.71-1.172-1.721-.01-1.372.832-2.98 1.938-3.887.17-.142.34-.265.51-.369 1.363-.785 2.47-.151 2.479 1.4 0 1.03-.473 2.184-1.173 3.082z"
          fill="#D9DADF"
        />
        <path
          d="M24.424 41.663l.851 3.99-3.243 1.873.822-4.964c-.7-.095-1.172-.71-1.172-1.721-.01-1.372.832-2.98 1.938-3.887 1.126-.388 1.967.265 1.977 1.626 0 1.022-.464 2.175-1.173 3.083z"
          fill="#BCBCBE"
        />
        <g>
          <path
            d="M42.948 50.755c0 1.168-.414 1.984-1.075 2.366l-1.395.817-.02.01-.042.021c-.672.393-1.602.33-2.625-.258-1.664-.961-3.06-3.028-3.524-5.013l-5.56-3.203-1.426.826-2.977-1.726v-1.653l-1.168-.672v-2.532l1.458-.847 10.572 6.097c.114-.082.227-.134.362-.176a1.255 1.255 0 00-.341.145l1.457-.847c.671-.383 1.591-.331 2.625.268 2.036 1.179 3.69 4.031 3.679 6.377z"
            fill="#FFF"
          />
          <path d="M28.702 45.495l-1.421.826v-1.653z" fill="#FFF" />
          <path
            d="M34.174 48.171c.02.176.051.341.093.527l-6.986-4.03v1.653l-2.977-1.726v-1.653l-1.168-.672v-2.532l11.141 6.428c-.236.71-.18 1.774-.103 2.005zm4.268.073c.124.03.248.082.382.155.786.454 1.437 1.55 1.447 2.47 0 2.151-2.904.626-2.904-1.654 0-.087.031-.413.083-.465.034-.17.238-.403.279-.403.186-.145.434-.186.713-.103"
            fill="#FFF"
          />
          <path
            d="M40.168 51.416c-.464 1.325-2.8-.202-2.8-2.201 0-.087.03-.413.082-.465.034-.17.237-.403.279-.403.186-.145.434-.186.713-.103a.079.079 0 00-.02.051c-.233.232-.046 2.153 1.363 2.966.135.083.259.135.383.155z"
            fill="#D9DADF"
          />
          <path
            d="M35.166 44.988c-.403.228-.713.63-.889 1.178l-11.14-6.428 1.457-.847 10.572 6.097zm7.782 5.767c0 1.168-.414 1.984-1.075 2.366l-1.457.848c.661-.382 1.075-1.21 1.075-2.367.01-2.346-1.644-5.208-3.68-6.376-1.033-.6-1.953-.651-2.624-.269l1.457-.847c.671-.383 1.591-.331 2.625.268 2.036 1.179 3.69 4.031 3.679 6.377z"
            fill="#FFF"
          />
          <path
            d="M68.065 21.936c.48-.27.75-.67.75-1.09l.09-4.96v-.03c0-.03 0-.06-.01-.09-.03-.39-.3-.75-.76-1.02l-11.12-6.42c-.9-.52-2.44-.52-3.33 0l-11.05 6.42c-.42.242-.76.621-.76 1.1l-.09 4.98c0 .43.28.82.77 1.11l1.1.64.005.002-1.026.596c-.491.286-.762.679-.761 1.105l.002.013-.09 4.964c0 .43.28.82.77 1.11l1.11.64-1.03.6c-.492.286-.763.678-.762 1.105l.002.013-.09 4.962c0 .43.28.83.77 1.11l11.13 6.43c.898.525 2.417.543 3.34-.01l11.04-6.42c.48-.27.75-.67.75-1.09l.09-4.96v-.03c0-.003-.003-.005-.003-.007-.003-.426-.273-.816-.763-1.098l-1.107-.64 1.033-.605c.48-.27.75-.67.75-1.09l.09-4.99c-.049-.146.003-.664-.766-1.107l-1.11-.64.006-.003 1.03-.6zm.28-1.1c0 .25-.19.5-.52.69l-11.04 6.42c-.339.209-.797.318-1.265.329v-4.51c.598 0 1.156-.14 1.585-.4l11.04-6.42c.1-.06.19-.12.27-.18l-.07 4.07zm-25.47-5.68l11.04-6.42c.784-.454 2.077-.454 2.86 0l11.13 6.42c.512.3.57.67.52.77 0 .232-.285.479-.51.61l-11.05 6.42c-.76.45-2.11.45-2.87.01l-11.12-6.43c-.703-.394-.71-.984 0-1.38zm-.08 6.37c-.35-.2-.53-.45-.53-.7l.06-4.09c.09.07.2.14.31.21l11.13 6.43c.36.21.8.34 1.28.38h.002v4.51h-.002c-.42-.03-.82-.13-1.13-.31l-11.12-6.43zm0 8.43c-.35-.2-.53-.45-.53-.69l.06-4.1c.1.08.29.203.31.215l11.13 6.435c.358.195.978.352 1.28.37v.01h.002v4.5h-.002c-.42-.03-.82-.13-1.13-.31l-11.12-6.43zm11.12 14.86l-11.12-6.43c-.35-.2-.53-.44-.53-.69l.06-4.1c.09.08.2.15.31.22l11.13 6.43c.518.259 1.067.37 1.28.37v.01h.002v4.5h-.002c-.42-.03-.82-.13-1.13-.31zm14.43-7.11c0 .67-.413.495-11.56 7.1-.339.209-.797.318-1.265.329v-4.5c.512 0 1.05-.114 1.495-.36l.041-.025c.014-.008.033-.01.047-.018l11.042-6.416c.08-.05.15-.09.21-.14.02-.01.04-.03.06-.04l-.07 4.07zm-.433-4.303l-11.057 6.413c-.023.017-.044.024-.064.034-.875.46-2.168.336-2.79-.022h-.002c-.1-.059-8.343-4.824-11.124-6.432-.02-.02-.05-.03-.07-.04-.506-.254-.716-.886.067-1.341l1.267-.737 9.546 5.518c.85.491 2.38.565 3.34-.01l9.524-5.547 1.353.781c.74.427.656 1.007.01 1.383zm.433-4.127c0 .25-.19.49-.52.68l-11.04 6.42c-.339.209-.797.318-1.265.329v-4.5c.549 0 1.047-.117 1.547-.39.01-.007.025-.009.036-.015 3.697-2.153 10.917-6.328 11.204-6.532.035-.025.076-.048.108-.072l-.07 4.08zm-.22-4.46c-.118.118.57-.306-11.27 6.57-.022.014-.05.023-.074.037-.83.43-2.088.373-2.781-.027l-11.193-6.47c-.073-.1-1.057-.69.065-1.343l1.266-.736 9.547 5.519c.925.534 2.396.535 3.34-.01l9.53-5.54h.009l1.338.772c.763.441.561 1.057.223 1.228zM25.847 15.379l-5.837 3.37.002.813 5.838-3.37zM24.23 57.258l-2.371 1.368a.311.311 0 00-.14.242l.008 2.062c0 .088.064.125.14.08l2.37-1.368a.312.312 0 00.14-.242l-.007-2.062c0-.088-.064-.125-.14-.08zm2.005-30.092c-1.412 0-3.045 1.658-3.87 2.83-.715 1.065-1.18 2.21-1.38 3.26-.095.284.17.437.33.33l5.92-3.41a.24.24 0 00.12-.2v-.39c-.034-.115.244-2.42-1.12-2.42zm-3.48 3.1c.505-.716 1.606-2.04 2.42-2.04.72 0 .643 1.193.68 1.67v.53l-4.31 2.49c.156-.656.584-1.733 1.21-2.65zm4.12-.43l-.55.32c-.055-.277.216-2.002-.83-2.35.26-.11.51-.17.74-.17.83 0 .618 1.798.64 2.2zm13.38 21.94c.15-.19.25-.47.25-.91-.01-1-.7-2.17-1.57-2.68-.16-.08-.3-.14-.43-.17-.717-.211-1.37.257-1.37 1.2 0 .828.375 1.635.9 2.16l.18.18c.572.546 1.404.864 2.04.23v-.01zm-.22-.91c0 .09-.01.17-.02.25-1.022-.512-1.534-1.927-1.45-2.58.04.02.09.05.14.07.72.42 1.32 1.43 1.33 2.26zm-1.46.38c-.52-.45-.97-1.2-.97-2.03 0-.816.436-.67.51-.77-.174 1.16.815 2.8 1.71 3.1-.315.313-.916-.008-1.25-.3z"
            fill="#908FA1"
          />
          <path
            d="M39.385 44.176c-1.06-.62-2.08-.71-2.86-.27l-1.17.68v-.11l-.1-33.66c0-1.028-.553-1.595-.87-1.7l-2.71-1.58c-.51-.29-1.17-.24-1.86.16l-19.67 11.36c-1.307.742-2.37 2.555-2.37 4.09l.12 41.26c0 .77.28 1.36.78 1.66l2.81 1.63.06.03c.19.11.41.16.66.16.35 0 .73-.12 1.12-.34l19.68-11.36c1.31-.76 2.38-2.6 2.37-4.11v-1.45a8.43 8.43 0 01-.48-1.01l.01 1.53v.93c0 1.36-.96 3.02-2.14 3.7l-19.68 11.36c-.31.18-.62.27-.88.27a.884.884 0 01-.71-.31c-.2-.24-.31-.6-.31-1.06l-.12-41.26c0-1.368.96-2.994 2.13-3.68l19.68-11.36c1.126-.635 1.91-.15 1.91 1.08l.1 33.63v.11l-3.21-1.86v-.1l-.04-11.1c0-.57-.2-1.01-.54-1.24v-.01c-.05-.1-1.81-1.063-1.91-1.12v-.22c-.01-1.86-.68-3.07-1.88-3.44-1.27-.47-2.45-2.413-5.4-.73-.093.1-5.05 2.98-5.05 8.47v1.89l-.6.35c-1.02.58-1.84 2.01-1.83 3.17l.03 12.39c0 .61.22 1.07.62 1.31l2.19 1.27h.02c.01.01.02.02.04.02l.01.01c.436.232.97.1 1.4-.15l11.1-6.41c.14-.08.27-.17.4-.29a.5.5 0 00.08-.07l3.83 2.21c.04.02.08.03.12.03h.01a.243.243 0 00.21-.36l-.03-.14c-.02-.1-.04-.21-.06-.34-.06-.19-.11-1.21.11-1.85v-.02c.153-.46.415-.784.62-.92.08.02.16 0 .23-.04v-.12c.14-.07.28-.13.44-.15.54-.12 1.21.04 1.9.44 1.97 1.13 3.57 3.9 3.56 6.17 0 .76-.2 1.4-.55 1.81l-.02.02c-.11.13-.24.24-.38.32l-.01.01a.24.24 0 00-.08.32c.05.07.13.12.21.12.04 0 .08-.02.12-.04l1.45-.84c.77-.44 1.19-1.36 1.19-2.57.01-2.41-1.69-5.36-3.8-6.58zm-30.47 21.48c-.35-.21-.54-.65-.54-1.26l-.12-41.26c0-.5.14-1.06.36-1.58l.002-.005 2.377 1.468a4.363 4.363 0 00-.399 1.757l.12 41.26c0 .14.01.27.03.4.01.11.03.22.06.32l-1.89-1.1zm24.08-56.5c-.02 0-.04.01-.06.02-.1.04-.2.09-.3.15l-19.68 11.36c-.777.434-1.325 1.142-1.757 1.904l-2.372-1.466c.39-.699.95-1.309 1.559-1.658l19.67-11.36c.417-.248.961-.4 1.38-.16l1.89 1.1c-.11.02-.22.06-.33.11zm-3.03 20.97c-.152.05-.327.13-.41.18l-.37.21v-.84l.78.45zm-1.26-1.26v.53l.01 1.39-9.19 5.31c.012-1.942-.014-1.9.02-2 0-3.123 3.37-8.28 6.9-8.28.06 0 .13 0 .19.01.29.04.56.13.81.27h.01c.04.02.09.03.14.02.72.45 1.1 1.39 1.11 2.75zm-6.56-3.72c2.52-1.44 3.431.011 4.01.19-2.61.182-6.453 3.46-7.07 8.4 0 .02 0 .05-.01.07.042.042-.037-.44-.02 2.29l-1.49-.87-.23-.13v-.28l-.01-1.63c0-5.21 4.726-7.94 4.82-8.04zm-6.83 26.76c-.25-.15-.39-.47-.39-.91l-.03-12.38c0-1 .73-2.26 1.6-2.76l.6-.35 1.72 1c-.384.269-.482.192-1.08.79-.714.757-1.12 1.784-1.12 2.6l.04 12.38c0 .15.01.29.04.42l-1.38-.79zm14.49-5.4c-.07.05-.14.1-.21.14l-11.1 6.41c-.583.33-1.007.165-1.06.06-.21-.15-.31-.45-.31-.84l-.04-12.38c0-.772.438-1.69.98-2.26.35-.429 1.914-1.24 11.72-6.91.783-.457 1.38-.146 1.38.77l.03 10.82v.11l-4.71-2.72c.19-.568.36-1.037.36-1.72-.01-1.2-.64-1.97-1.61-1.97-1.839 0-3.805 2.698-3.79 4.82 0 .99.43 1.7 1.14 1.91l-.79 4.74a.252.252 0 00.24.28c.04 0 .08-.01.11-.04l3.46-1.99.1-.06 1.46.85c.07.04.16.04.23 0l1.31-.76 1.18.68c-.03.02-.05.04-.08.06zm-5.62-1.71l.76.44.06.3-2.66 1.54.74-4.46v-.02c0-.03 0-.05-.01-.08l.99.56v1.52c0 .08.05.16.12.2zm-1.17-5.26a.23.23 0 00-.11.2v2.53c0 .02 0 .05.02.07-.01 0-.03-.01-.04-.01-.03 0-.05-.01-.08-.02-.56-.11-.89-.66-.89-1.47 0-1.34.822-2.826 1.82-3.67h.01c.94-.31 1.61.27 1.62 1.42 0 .162-.034.432-.04.45l-.61-.35a.255.255 0 00-.24 0l-1.46.85zm1.53-2.89c.24-.11.48-.16.69-.16.7 0 1.13.57 1.14 1.5 0 .68-.184 1.129-.3 1.48l-.31-.17c.02-.06.07-.421.07-.72-.01-1.05-.5-1.79-1.29-1.93zm2.97 9.26v-.83l.63.36.09.06-.72.41zm6.41 2.21c0 .03 0 .06.01.08s.01.03.01.04l-3.28-1.89-.42-.24-1.41-.81-.21-.12-1.23-.71a.201.201 0 00-.11-.03c-.05 0-.09.01-.12.03a.22.22 0 00-.12.2v1.25l-2.5-1.46v-1.51c0-.09-.05-.17-.12-.21l-.02-.01-1.03-.59v-1.98l.09.05c1.733.998 10.63 6.137 10.53 6.08-.16.68-.14 1.52-.07 1.83zm.73-3.04c-.2.2-.37.45-.5.75l-10.46-6.04-.09-.05.99-.57c17.665 10.17-6.845-3.946 10.13 5.84-.02.02-.05.04-.07.07zm7.1 7.84l-.31.18c.02-.04.04-.09.05-.14.16-.39.23-.85.23-1.35.01-2.42-1.69-5.38-3.79-6.58-.47-.27-.91-.44-1.34-.51-.05-.01-.09-.02-.14-.02l.31-.18c.62-.36 1.47-.26 2.39.27 1.97 1.14 3.57 3.91 3.56 6.17 0 1.04-.34 1.8-.96 2.16z"
            fill="#908FA1"
          />
          <path d="M71.445 55.956c0-2.05-1.35-3.96-3.8-5.38-2.42-1.41-5.62-2.18-9.03-2.18-3.39 0-6.59.77-9 2.16-2.52 1.45-3.9 3.39-3.89 5.47l.01 1.87c0 1.22.5 2.42 1.44 3.48l-.62.36-.73-.42a.273.273 0 00-.3 0l-9.75 5.57c-.51.3-.79.72-.78 1.17v2.27c0 .45.28.86.79 1.16.94.542 2.46.53 3.38-.01l9.73-5.57c.09-.05.15-.15.15-.26v-1.58l.59-.35v.06c0 .11.06.21.16.26 2.37 1.31 5.49 2.03 8.76 2.03 3.41 0 6.62-.77 9.03-2.17 2.5-1.44 3.87-3.37 3.87-5.45l-.01-2.49zm-4.16 7.41c-2.33 1.35-5.43 2.09-8.73 2.09-3.1 0-6.05-.66-8.31-1.86v-.41c0-.11-.06-.21-.15-.26a.339.339 0 00-.31 0l-1.19.71c-.09.05-.15.15-.15.26l-.01 1.57-9.58 5.49c-.74.431-1.994.452-2.77 0-.31-.18-.49-.41-.49-.63l.01-2.22v-.05c-.01-.23.16-.46.47-.65l9.6-5.48.73.42c.09.05.21.05.3 0l1.1-.63a.31.31 0 00.15-.22.34.34 0 00-.08-.26c-1-1.01-1.53-2.17-1.54-3.34l-.01-1.87c0-1.85 1.27-3.61 3.59-4.95 2.33-1.34 5.41-2.07 8.7-2.07 3.3 0 6.4.74 8.72 2.09 2.26 1.31 3.5 3.04 3.5 4.86l.02 2.5c0 1.84-1.27 3.59-3.57 4.91zm-24.88-31.888c-.49.324-.77.751-.77 1.218l-.08 4.998c0 .565.392 1.024.88 1.306l11.13 6.439c.483.278 1.111.43 1.767.43.514 0 1.008-.094 1.43-.267.135-.054.264-.116.383-.186l3.737-2.174L68.19 39c.55-.322.867-.793.867-1.287l.08-4.997c0-.303-.12-.584-.326-.835a1.993 1.993 0 00-.556-.475l-.75-.44.69-.4c.55-.32.86-.79.86-1.28l.08-5c0-.52-.31-.98-.88-1.31l-.76-.44.7-.4c.55-.32.86-.79.86-1.28l.08-5c0-.3-.11-.87-.88-1.31l-11.13-6.42c-.96-.57-2.6-.56-3.56 0l-11.06 6.41c-.56.34-.87.8-.87 1.3l-.08 5c0 .29.11.86.88 1.3l.75.43v.01l-.68.39c-.56.34-.87.8-.87 1.3l-.08 5c0 .51.31.97.88 1.3l.759.439-.685.397c-.039.023-.067.051-.103.076zm24.147.04l1.232.71c.26.15.408.329.408.48l-.08 4.998c0 .153-.15.331-.397.476L56.66 44.601c-.465.278-1.203.354-1.845.256-.29-.046-.565-.117-.78-.241l-4.228-2.443-6.9-3.991c-.258-.15-.407-.328-.407-.48l.085-4.996c0-.144.144-.322.374-.469.01-.006.019-.014.03-.02l1.15-.669 9.426 5.458c.48.28 1.11.43 1.77.43.67 0 1.32-.16 1.81-.45l9.407-5.469zM42.905 21.315c-.26-.15-.41-.32-.41-.48l.09-4.99c0-.16.15-.34.4-.49l11.05-6.42c.34-.19.81-.3 1.31-.3s.97.11 1.31.3l11.13 6.43c.26.15.41.33.41.48l-.08 5c0 .15-.15.33-.4.47l-11.05 6.42c-.68.41-1.94.41-2.63.02-8.936-5.165-1.915-1.107-11.13-6.44zm-.41 7.95l.09-4.99c0-.16.15-.34.4-.49l1.15-.67 9.43 5.46c.48.28 1.11.43 1.77.43.67 0 1.32-.16 1.81-.45 6.299-3.66 3.45-2.006 9.41-5.47l1.23.71c.26.15.41.33.41.48l-.08 5c0 .15-.15.33-.4.48l-11.05 6.41c-.68.41-1.94.42-2.63.02l-11.13-6.44c-.26-.14-.41-.32-.41-.48zm-4.87 24.73c.912.527 2.023.786 2.94.27 0 0 .07-.04.08-.04l1.39-.82c.8-.46 1.24-1.4 1.24-2.65.01-2.44-1.71-5.43-3.84-6.66-1.09-.64-2.15-.73-2.96-.27l-.88.51-.1-33.53c-.01-.89-.36-1.58-.94-1.87a.218.218 0 01-.05-.03l-2.71-1.57c-.58-.34-1.34-.29-2.1.15l-19.67 11.36c-1.39.8-2.48 2.69-2.48 4.3l.12 41.26c0 .86.32 1.52.89 1.86l2.82 1.64c.01.01.02.01.04.02.23.13.5.19.78.19.4 0 .82-.12 1.25-.37l19.68-11.36c1.37-.78 2.44-2.62 2.49-4.2.58.75 1.28 1.39 2.01 1.81zm-2.95-1.92c0 1.26-.93 2.86-2.02 3.49l-19.69 11.36c-.27.16-.54.25-.77.25-.13 0-.25-.03-.43-.15a.507.507 0 00-.15-.07l-2.58-1.51c-.28-.16-.43-.53-.43-1.05l-.12-41.26c0-1.27.91-2.83 2.01-3.47l19.68-11.36c.45-.26.86-.32 1.14-.16l2.73 1.59c.02.01.04.02.07.03.27.14.43.53.44 1.05l.1 33.5-2.75-1.59-.03-11.23c0-.67-.25-1.19-.68-1.47a.346.346 0 00-.12-.07l-.01-.01-1.64-.96v-.08c-.01-1.62-.59-2.84-1.62-3.43l-2.18-1.27c-1.03-.6-2.4-.49-3.84.32l-.25.15c-2.76 1.62-4.92 5.36-4.92 8.53l.01 1.75-.49.28c-1.1.64-1.95 2.12-1.94 3.38l.03 12.38c0 .69.27 1.25.73 1.52l2.2 1.27c.01.01.02.01.02.02.01 0 .02.01.03.01.19.1.41.15.64.15.32 0 .66-.1 1.01-.29l11.1-6.42c.17-.1.34-.23.5-.37l3.52 2.03c.147.559.563 1.652.7 1.79v1.37zm-11.86-9.75c0 .158.15.218.27.29l.89.52v1.46c0 .12.06.23.16.29l2.98 1.72c.1.06.23.06.33 0l1.26-.73.87.5-.09.06-11.1 6.42c-.27.15-.53.2-.69.14-.03-.02-.06-.04-.1-.05a.507.507 0 00-.16-.09l-2-1.16c-.17-.1-.27-.35-.27-.7l-.03-12.39c-.01-.91.67-2.08 1.47-2.55l.73-.41c.14-.09.23-.24.23-.41v-2.05c0-2.8 1.99-6.25 4.45-7.69l.25-.15c1.1-.63 2.15-.75 2.88-.32l2.19 1.28c.73.41 1.13 1.34 1.14 2.6v.36c0 .16.09.32.24.4l1.85 1.08c.02.02.05.04.09.06.17.08.27.34.27.69l.03 10.68c-10.662-6.127-2.65-1.526-6.2-3.57a.325.325 0 00-.33 0l-1.46.85c-.1.06-.16.17-.16.28v2.57c0 .01 0 .01.01.02zm11.77 6.3a.368.368 0 00-.05-.11c-.01-.01-.02-.03-.03-.04-.01-.02-.03-.03-.05-.04 0 0-.01-.02-.02-.02l-.51-.3c-5.484-3.159-5.069-2.95-5.22-2.95-.03 0-.06 0-.08.01-.03.01-.05.01-.08.03l-1.26.73-.24-.14-2.41-1.39v-1.46c0-.12-.06-.23-.17-.29l-1-.58v-2.15l1.13-.65 10.06 5.8c.187.068.422.348.7.19 0-.01.01-.01.01-.01.031-.026 1.475-.88 1.44-.86.6-.34 1.42-.24 2.3.27 1.95 1.13 3.52 3.86 3.51 6.09 0 1-.32 1.74-.91 2.08l-1.38.81s-.07.03-.08.04c-.58.34-1.41.24-2.29-.26-1.625-.915-3.049-3.195-3.37-4.8z" />
        </g>
      </svg>
    ),
    label: "RBAC",
    permission: "rbac",
    subItems: [
      {
        icon: <PiShieldChevron />,
        label: "Roles",
        link: "/admin/rbac/roles",
        permission: "roles",
      },
      {
        icon: <PiLockKeyOpen />,
        label: "Permissions",
        link: "/admin/rbac/permissions",
        permission: "permissions",
      },
      {
        icon: <LuUsersRound />,
        label: "Staff",
        link: "/admin/rbac/staff",
        permission: "staff",
      },
    ],
  },
  {
    icon: <LiaGiftSolid />,
    label: "Gifts",
    link: "/admin/gifts",
    permission: "gifts",
  },
  {
    icon: <FiBarChart2 />,
    label: "Report & Analytics",
    link: "/admin/analytics",
    permission: "analytics",
    subItems: [
      {
        icon: <BsBarChartLine />,
        label: "Sales Reports",
        link: "/admin/analytics/sales-reports",
        permission: "sales-reports",
      },
      {
        icon: <LiaBoxesSolid />,
        label: "Order Reports",
        link: "/admin/analytics/order-reports",
        permission: "order-reports",
      },
    ],
  },
];

const Permission = () => {
  const [permissions, setPermissions] = useState([]);
  const [loading, setLoading] = useState(false);
  const [isDialogOpen, setIsDialogOpen] = useState(false);
  const [isEditMode, setIsEditMode] = useState(false);
  const [currentPermissionId, setCurrentPermissionId] = useState(null);
  const [staff, setStaff] = useState([]);
  const [deleteConfirmOpen, setDeleteConfirmOpen] = useState(false);
  const [permissionToDelete, setPermissionToDelete] = useState(null);
  const [selectedStaff, setSelectedStaff] = useState(null);
  const [selectedPermissions, setSelectedPermissions] = useState([]);

  const validationSchema = Yup.object({
    name: Yup.string()
      .required("Name is required")
      .matches(/^[a-z-]+$/, "Name must be lowercase with hyphens only"),
    label: Yup.string().required("Label is required"),
    module: Yup.string().required("Module is required"),
  });

  const formik = useFormik({
    initialValues: {
      name: "",
      label: "",
      module: "",
    },
    validationSchema,
    onSubmit: async (values) => {
      try {
        if (isEditMode) {
          await updatePermission(currentPermissionId, values);
          toast.success("Permission updated successfully");
        } else {
          await createPermission(values);
          toast.success("Permission created successfully");
        }
        fetchData();
        setIsDialogOpen(false);
        formik.resetForm();
      } catch (error) {
        toast.error(error.response?.data?.message || "An error occurred");
      }
    },
  });

  const fetchData = async () => {
    setLoading(true);
    try {
      const res = await getAllPermissions();
      setPermissions(res.data);

      const response = await fetchStaff();
      setStaff(response.data.data.staff || []);
    } catch (err) {
      console.log(err.message);
    } finally {
      setLoading(false);
    }
  };

  const handleEditPermission = async (id) => {
    try {
      setCurrentPermissionId(id);
      const res = await getPermissionById(id);
      formik.setValues({
        name: res.data.name,
        label: res.data.label,
        module: res.data.module,
      });
      setIsEditMode(true);
      setIsDialogOpen(true);
    } catch (error) {
      toast.error("Failed to fetch permission details");
    }
  };

  const handleAddPermission = () => {
    setIsEditMode(false);
    setCurrentPermissionId(null);
    formik.resetForm();
    setIsDialogOpen(true);
  };

  useEffect(() => {
    fetchData();
  }, []);

  const handleDeleteClick = (id) => {
    setPermissionToDelete(id);
    setDeleteConfirmOpen(true);
  };

  const confirmDelete = async () => {
    if (permissionToDelete) {
      await handleDelete(permissionToDelete);
      setDeleteConfirmOpen(false);
      setPermissionToDelete(null);
    }
  };

  const handleDelete = async (id) => {
    try {
      const response = await deletePermission(id);
      if (response.status === 200) {
        toast.success("Permission deleted successfully");
        fetchData();
      } else {
        toast.error(response.data.message || "Failed to delete Permission");
      }
    } catch (error) {
      console.log("Delete error:", error);
      toast.error(
        error.response?.data?.message || "Failed to delete Permission"
      );
    }
  };

  const handleStaffChange = (staffId) => {
    const selected = staff.find((s) => s.id === staffId);
    setSelectedStaff(selected);

    // Get all permission IDs the staff has (from role and extraPermissions)
    const staffPermissions = [
      ...(selected?.role?.permissions || []).map((p) => p.id),
      ...(selected?.extraPermissions || []).map((p) => p.id),
    ];

    setSelectedPermissions(staffPermissions);
  };

  const handlePermissionToggle = async (permissionId) => {
    if (!selectedStaff) return;

    try {
      const isCurrentlyAssigned = selectedPermissions.includes(permissionId);

      if (isCurrentlyAssigned) {
        // Remove permission
        await removePermissionsFromAdmin(selectedStaff.id, [permissionId]);
        setSelectedPermissions(
          selectedPermissions.filter((id) => id !== permissionId)
        );
        toast.success("Permission removed successfully");
      } else {
        // Add permission
        await assignPermissionsToAdmin(selectedStaff.id, [permissionId]);
        setSelectedPermissions([...selectedPermissions, permissionId]);
        toast.success("Permission assigned successfully");
      }

      setTimeout(() => {
        fetchData();
      }, 1000);
    } catch (error) {
      toast.error("Failed to update permissions");
      console.log(error);
    }
  };

  const getAllPermissionItems = () => {
    const allItems = [];

    menuItems.forEach((item) => {
      if (item.link) {
        // It's a main menu item with direct permission
        allItems.push({
          module: item.label,
          permission: item.permission,
          label: item.label,
        });
      }

      if (item.subItems) {
        item.subItems.forEach((subItem) => {
          allItems.push({
            module: item.label,
            permission: subItem.permission,
            label: subItem.label,
          });
        });
      }
    });

    return allItems;
  };

  const getPermissionsForModule = (moduleName) => {
    if (!moduleName) return [];

    const module = menuItems.find((item) => item.label === moduleName);
    if (!module) return [];

    const permissions = [];

    // Add main permission if exists
    if (module.link) {
      permissions.push({
        permission: module.permission,
        label: module.label,
      });
    }

    // Add sub items permissions
    if (module.subItems) {
      module.subItems.forEach((item) => {
        permissions.push({
          permission: item.permission,
          label: item.label,
        });
      });
    }

    return permissions;
  };

  return (
    <>
      <div className="w-full poppins">
        <div className="mb-4">
          <h2 className="text-2xl font-semibold mb-4">RBAC</h2>
          <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
            <p className="text-md font-semibold ">Permissions</p>
            <div className="flex items-center gap-1 overflow-x-auto scrollbarWidthThinAdmin">
              <div className="mr-4">
                <Select onValueChange={handleStaffChange}>
                  <SelectTrigger className="sm:w-[180px]">
                    <SelectValue placeholder="Select staff" />
                  </SelectTrigger>
                  <SelectContent>
                    {staff.map((staffMember) => (
                      <SelectItem key={staffMember.id} value={staffMember.id}>
                        {staffMember.name}
                      </SelectItem>
                    ))}
                  </SelectContent>
                </Select>
              </div>
              <Button
                className="addButton bg-Lime  text-black"
                onClick={handleAddPermission}
              >
                <FiPlus />
                Add Permission
              </Button>
            </div>
          </div>
        </div>

        <div
          className="grid gap-4 bg-[#f0f6f9]"
          style={{
            gridTemplateColumns: "repeat(auto-fill, minmax(300px, 1fr))",
          }}
        >
          {loading ? (
            <>
              <div className="cardBG rounded-3xl shadow-md p-5 w-full relative">
                <div className="absolute top-3 right-3 flex gap-2">
                  <Skeleton className="h-8 w-8 rounded-sm border border-[#979797]" />
                  <Skeleton className="h-8 w-8 rounded-sm border border-[#979797]" />
                </div>
                <Skeleton className="h-6 w-1/3 mb-2" />
                <div>
                  <Skeleton className="h-4 w-1/4 mb-1" />
                  <div className="flex flex-wrap gap-2">
                    <Skeleton className="h-6 w-20 rounded-full" />
                    <Skeleton className="h-6 w-20 rounded-full" />
                    <Skeleton className="h-6 w-20 rounded-full" />
                  </div>
                </div>
              </div>

              <div className="cardBG rounded-3xl shadow-md p-5 w-full relative">
                <div className="absolute top-3 right-3 flex gap-2">
                  <Skeleton className="h-8 w-8 rounded-sm border border-[#979797]" />
                  <Skeleton className="h-8 w-8 rounded-sm border border-[#979797]" />
                </div>
                <Skeleton className="h-6 w-1/3 mb-2" />
                <div>
                  <Skeleton className="h-4 w-1/4 mb-1" />
                  <div className="flex flex-wrap gap-2">
                    <Skeleton className="h-6 w-20 rounded-full" />
                    <Skeleton className="h-6 w-20 rounded-full" />
                    <Skeleton className="h-6 w-20 rounded-full" />
                  </div>
                </div>
              </div>

              <div className="cardBG rounded-3xl shadow-md p-5 w-full relative">
                <div className="absolute top-3 right-3 flex gap-2">
                  <Skeleton className="h-8 w-8 rounded-sm border border-[#979797]" />
                  <Skeleton className="h-8 w-8 rounded-sm border border-[#979797]" />
                </div>
                <Skeleton className="h-6 w-1/3 mb-2" />
                <div>
                  <Skeleton className="h-4 w-1/4 mb-1" />
                  <div className="flex flex-wrap gap-2">
                    <Skeleton className="h-6 w-20 rounded-full" />
                    <Skeleton className="h-6 w-20 rounded-full" />
                    <Skeleton className="h-6 w-20 rounded-full" />
                  </div>
                </div>
              </div>
            </>
          ) : permissions.length > 0 ? (
            permissions.map((item, index) => (
              <div
                key={index}
                className="cardBG rounded-3xl shadow-md p-5 w-full relative"
              >
                <div className="absolute top-3 right-3 flex gap-2">
                  <Button
                    variant={"edit"}
                    className="p-1 border border-[#979797]"
                    onClick={() => handleEditPermission(item.id)}
                  >
                    <Pencil size={16} />
                  </Button>

                  <Button
                    variant="edit"
                    className="text-[10px] md:text-sm px-2 rounded-sm hover:shadow-xl border border-[#979797]"
                    onClick={() => handleDeleteClick(item.id)}
                  >
                    <FiTrash2 />
                  </Button>
                </div>

                <div className="flex items-center gap-2">
                  {selectedStaff && (
                    <Checkbox
                      checked={selectedPermissions.includes(item.id)}
                      onCheckedChange={() => handlePermissionToggle(item.id)}
                    />
                  )}
                  <h2 className="text-lg font-semibold ">{item.label}</h2>
                </div>

                <div className="mt-4">
                  <span className="font-medium text-black text-sm block mb-2">
                    Roles Assigned
                  </span>
                  <div className="flex flex-wrap gap-2">
                    {item.roles?.length > 0 ? (
                      item.roles.map((ro, i) => (
                        <span
                          key={i}
                          className="text-xs bg-white px-3 py-1 rounded-full drop-shadow-md"
                        >
                          {ro.role?.name}
                        </span>
                      ))
                    ) : (
                      <span className="text-xs bg-white px-3 py-1 rounded-full drop-shadow-md">
                        No roles assigned
                      </span>
                    )}
                  </div>
                </div>
              </div>
            ))
          ) : (
            <div className="col-span-full text-center text-2xl py-10 text-gray-500">
              No data available
            </div>
          )}
        </div>
      </div>

      <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>
        <DialogContent>
          <DialogHeader>
            <DialogTitle>
              {isEditMode ? "Edit Permission" : "Create Permission"}
            </DialogTitle>
            <DialogDescription>
              {isEditMode
                ? "Update the permission details below"
                : "Fill in the details to create a new permission"}
            </DialogDescription>
          </DialogHeader>

          <form
            onSubmit={formik.handleSubmit}
            autoComplete="off"
            className="space-y-4"
          >
            <div>
              <Select
                name="module"
                value={formik.values.module}
                onValueChange={(value) => formik.setFieldValue("module", value)}
              >
                <SelectTrigger className="w-full InputShadow">
                  <SelectValue placeholder="Select module" />
                </SelectTrigger>
                <SelectContent>
                  {menuItems.map((item) => (
                    <SelectItem key={item.permission} value={item.label}>
                      {item.label}
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
              {formik.touched.module && formik.errors.module && (
                <div className="text-red-500 text-xs mt-1">
                  {formik.errors.module}
                </div>
              )}
            </div>

            <div>
              <Select
                name="name"
                value={formik.values.name}
                onValueChange={(value) => {
                  formik.setFieldValue("name", value);
                  // Automatically set the label based on selected permission
                  const selectedItem = getAllPermissionItems().find(
                    (p) => p.permission === value
                  );
                  if (selectedItem) {
                    formik.setFieldValue("label", selectedItem.label);
                  }
                }}
                disabled={!formik.values.module}
              >
                <SelectTrigger className="w-full InputShadow">
                  <SelectValue placeholder="Select permission" />
                </SelectTrigger>
                <SelectContent>
                  {getPermissionsForModule(formik.values.module).map((item) => (
                    <SelectItem key={item.permission} value={item.permission}>
                      {item.label} ({item.permission})
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
              {formik.touched.name && formik.errors.name && (
                <div className="text-red-500 text-xs mt-1">
                  {formik.errors.name}
                </div>
              )}
            </div>

            <div>
              <input
                type="text"
                name="label"
                placeholder="Display Label"
                className="w-full px-4 py-2 rounded-md text-sm InputShadow focus:outline-none"
                value={formik.values.label}
                onChange={formik.handleChange}
                onBlur={formik.handleBlur}
                readOnly
              />
              {formik.touched.label && formik.errors.label && (
                <div className="text-red-500 text-xs mt-1">
                  {formik.errors.label}
                </div>
              )}
            </div>

            <DialogFooter>
              <Button
                type="button"
                variant="outline"
                onClick={() => {
                  setIsDialogOpen(false);
                  formik.resetForm();
                }}
              >
                Cancel
              </Button>
              <Button type="submit">
                {isEditMode ? "Update Permission" : "Create Permission"}
              </Button>
            </DialogFooter>
          </form>
        </DialogContent>
      </Dialog>

      <Dialog open={deleteConfirmOpen} onOpenChange={setDeleteConfirmOpen}>
        <DialogContent>
          <DialogHeader>
            <DialogTitle>Confirm Deletion</DialogTitle>
            <DialogDescription>
              Are you sure you want to delete this permission? This action
              cannot be undone.
            </DialogDescription>
          </DialogHeader>
          <DialogFooter>
            <Button
              variant="outline"
              onClick={() => setDeleteConfirmOpen(false)}
            >
              Cancel
            </Button>
            <Button variant="destructive" onClick={confirmDelete}>
              Delete
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>
    </>
  );
};

export default Permission;
